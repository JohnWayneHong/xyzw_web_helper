import{d as P,c as g,o as _,a as r,m as ze,n as Ae,p as We,r as S,q as J,s as Be,b as Ie,g as t,v as w,u as i,f as L,l as k,w as n,N as h,i as b,t as $,F as Fe,j as je,x as K,y as se,h as Pe,z as E}from"./index-RWkRG8TU.js";import{_ as Ne}from"./xiaoyugan-Dwisk7G8.js";import{T as Oe,A as te,H as oe}from"./ThemeToggle-SFT_kWu0.js";import{_ as qe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as De,T as He,C as Ve,a as ne,E as Ge}from"./TrashBin-cNj9_0Bk.js";import{R as re}from"./Refresh-7PsdRDpj.js";const Je={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ke=r("path",{d:"M408 480H184a72 72 0 0 1-72-72V184a72 72 0 0 1 72-72h224a72 72 0 0 1 72 72v224a72 72 0 0 1-72 72z",fill:"currentColor"},null,-1),Xe=r("path",{d:"M160 80h235.88A72.12 72.12 0 0 0 328 32H104a72 72 0 0 0-72 72v224a72.12 72.12 0 0 0 48 67.88V160a80 80 0 0 1 80-80z",fill:"currentColor"},null,-1),Ye=[Ke,Xe],Ze=P({name:"Copy",render:function(m,y){return _(),g("svg",Je,Ye)}}),Qe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},es=r("path",{d:"M218.1 167.17c0 13 0 25.6 4.1 37.4c-43.1 50.6-156.9 184.3-167.5 194.5a20.17 20.17 0 0 0-6.7 15c0 8.5 5.2 16.7 9.6 21.3c6.6 6.9 34.8 33 40 28c15.4-15 18.5-19 24.8-25.2c9.5-9.3-1-28.3 2.3-36s6.8-9.2 12.5-10.4s15.8 2.9 23.7 3c8.3.1 12.8-3.4 19-9.2c5-4.6 8.6-8.9 8.7-15.6c.2-9-12.8-20.9-3.1-30.4s23.7 6.2 34 5s22.8-15.5 24.1-21.6s-11.7-21.8-9.7-30.7c.7-3 6.8-10 11.4-11s25 6.9 29.6 5.9c5.6-1.2 12.1-7.1 17.4-10.4c15.5 6.7 29.6 9.4 47.7 9.4c68.5 0 124-53.4 124-119.2S408.5 48 340 48s-121.9 53.37-121.9 119.17zM400 144a32 32 0 1 1-32-32a32 32 0 0 1 32 32z",fill:"currentColor"},null,-1),ss=[es],ts=P({name:"Key",render:function(m,y){return _(),g("svg",Qe,ss)}}),os={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ns=r("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-miterlimit":"10","stroke-width":"48",d:"M88 152h336"},null,-1),rs=r("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-miterlimit":"10","stroke-width":"48",d:"M88 256h336"},null,-1),ls=r("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-miterlimit":"10","stroke-width":"48",d:"M88 360h336"},null,-1),as=[ns,rs,ls],is=P({name:"Menu",render:function(m,y){return _(),g("svg",os,as)}}),cs={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},us=r("path",{d:"M394 480a16 16 0 0 1-9.39-3L256 383.76L127.39 477a16 16 0 0 1-24.55-18.08L153 310.35L23 221.2a16 16 0 0 1 9-29.2h160.38l48.4-148.95a16 16 0 0 1 30.44 0l48.4 149H480a16 16 0 0 1 9.05 29.2L359 310.35l50.13 148.53A16 16 0 0 1 394 480z",fill:"currentColor"},null,-1),ds=[us],ms=P({name:"Star",render:function(m,y){return _(),g("svg",cs,ds)}}),ps={class:"token-import-page"},vs={class:"container"},fs={class:"page-header"},_s={class:"header-content"},ks={class:"header-top"},hs={key:0,class:"import-section"},Ts={class:"import-card"},gs={class:"card-header"},ws={class:"optional-fields"},bs={class:"form-actions"},ys={class:"optional-fields"},Us={class:"form-actions"},xs={key:1,class:"tokens-section"},Cs={class:"section-header"},Ss={class:"header-actions"},$s={class:"tokens-grid"},Es=["onClick"],Ms={class:"card-header"},Rs={class:"token-info"},Ls={class:"token-name"},zs=["title"],As={class:"token-meta"},Ws={key:0,class:"meta-item"},Bs={class:"connection-status"},Is={class:"card-actions"},Fs={class:"card-body"},js={class:"token-display"},Ps={class:"token-value"},Ns={class:"connection-status"},Os={class:"status-indicator"},qs={class:"status-text"},Ds={class:"connection-actions"},Hs={class:"token-timestamps"},Vs={class:"timestamp-item"},Gs={class:"timestamp-value"},Js={class:"timestamp-item"},Ks={class:"timestamp-value"},Xs={class:"storage-info"},Ys={class:"storage-item"},Zs={key:0,class:"storage-upgrade"},Qs={key:0,class:"card-footer"},et={key:2,class:"empty-state"},st={class:"modal-actions"},tt={__name:"TokenImport",props:{token:String,name:String,server:String,wsUrl:String,api:String,auto:Boolean},setup(z){const m=z,y=Pe(),l=ze(),A=Ae(),a=We(),C=S(!1),M=S(!1),W=S(!1),N=S(null),O=S(null),q=S(null),F=S(null),B=S("manual"),D=S(new Set),H=S(new Set),f=J({name:"",base64Token:"",server:"",wsUrl:""}),p=J({name:"",url:"",server:"",wsUrl:""}),U=J({name:"",server:"",wsUrl:""}),le={name:[{required:!0,message:"请输入Token名称",trigger:"blur"}],base64Token:[{required:!0,message:"请输入Base64 Token",trigger:"blur"}]},ae={name:[{required:!0,message:"请输入Token名称",trigger:"blur"}],url:[{required:!0,message:"请输入Token获取地址",trigger:"blur"},{type:"url",message:"请输入有效的URL地址",trigger:"blur"}]},ie={name:[{required:!0,message:"请输入Token名称",trigger:"blur"}]},ce=[{label:"导出所有Token",key:"export"},{label:"导入Token文件",key:"import"},{label:"清理过期Token",key:"clean"},{label:"断开所有连接",key:"disconnect"},{label:"清除所有Token",key:"clear"}],ue=async()=>{var s;if(N.value)try{await N.value.validate(),M.value=!0;const e=a.importBase64Token(f.name,f.base64Token,{server:f.server,wsUrl:f.wsUrl,importMethod:"manual"});if(e.success)l.success(e.message),e.details,pe(),C.value=!1;else{const u=e.error||e.message||"Token导入失败";l.error(u),console.error("Token导入错误详情:",{error:e.error,message:e.message,originalToken:((s=f.base64Token)==null?void 0:s.substring(0,50))+"..."})}}catch{}finally{M.value=!1}},de=async()=>{var s;if(O.value)try{await O.value.validate(),M.value=!0;let e;if(p.url.startsWith(window.location.origin)||p.url.startsWith("/")||p.url.startsWith("http://localhost")||p.url.startsWith("http://127.0.0.1"))e=await fetch(p.url);else try{e=await fetch(p.url,{method:"GET",headers:{Accept:"application/json"},mode:"cors"})}catch(v){throw new Error(`跨域请求被阻止。请确保目标服务器支持CORS，或使用浏览器扩展/代理服务器。错误详情: ${v.message}`)}if(!e.ok)throw new Error(`请求失败: ${e.status} ${e.statusText}`);const d=await e.json();if(!d.token)throw new Error("返回数据中未找到token字段");const c=a.importBase64Token(p.name,d.token,{server:p.server||d.server,wsUrl:p.wsUrl,sourceUrl:p.url,importMethod:"url"});if(c.success)l.success(c.message),c.details,ve(),C.value=!1;else{const v=c.error||c.message||"URL Token导入失败";l.error(v),console.error("URL Token导入错误详情:",{error:c.error,message:c.message,sourceUrl:p.url,receivedToken:((s=d==null?void 0:d.token)==null?void 0:s.substring(0,50))+"..."})}}catch(e){console.error("URL获取Token失败:",e),l.error(e.message||"URL获取Token失败")}finally{M.value=!1}},j=async s=>{D.value.add(s.id);try{if(s.sourceUrl){let e;if(s.sourceUrl.startsWith(window.location.origin)||s.sourceUrl.startsWith("/")||s.sourceUrl.startsWith("http://localhost")||s.sourceUrl.startsWith("http://127.0.0.1"))e=await fetch(s.sourceUrl);else try{e=await fetch(s.sourceUrl,{method:"GET",headers:{Accept:"application/json"},mode:"cors"})}catch(c){throw new Error(`跨域请求被阻止。请确保目标服务器支持CORS。错误详情: ${c.message}`)}if(!e.ok)throw new Error(`请求失败: ${e.status} ${e.statusText}`);const d=await e.json();if(!d.token)throw new Error("返回数据中未找到token字段");a.updateToken(s.id,{token:d.token,server:d.server||s.server,lastRefreshed:Date.now()}),l.success("Token刷新成功")}else{A.info({title:"重新获取Token",content:`Token "${s.name}" 是手动导入的，没有配置自动刷新地址。

请选择以下操作：
1. 重新手动导入新的Token
2. 尝试重新连接现有Token`,positiveText:"重新导入",negativeText:"重新连接",onPositiveClick:()=>{C.value=!0,B.value="manual",f.name=s.name,f.server=s.server,f.wsUrl=s.wsUrl},onNegativeClick:()=>{a.getWebSocketStatus(s.id)==="connected"&&a.closeWebSocketConnection(s.id),setTimeout(()=>{a.createWebSocketConnection(s.id,s.token,s.wsUrl),l.info("正在尝试重新连接...")},500)}});return}a.getWebSocketStatus(s.id)==="connected"&&(a.closeWebSocketConnection(s.id),setTimeout(()=>{a.createWebSocketConnection(s.id,s.token,s.wsUrl)},500))}catch(e){console.error("刷新Token失败:",e),l.error(e.message||"Token刷新失败")}finally{D.value.delete(s.id)}},me=s=>{A.warning({title:"升级为长期有效",content:`确认要将Token "${s.name}" 升级为长期有效吗？升级后该Token将不会因24小时未使用而被自动清理。`,positiveText:"确认升级",negativeText:"取消",onPositiveClick:()=>{a.upgradeTokenToPermanent(s.id)?l.success(`Token "${s.name}" 已升级为长期有效！`):l.error("升级失败，该Token可能已经是长期有效状态")}})},pe=()=>{Object.keys(f).forEach(s=>{f[s]=""})},ve=()=>{Object.keys(p).forEach(s=>{p[s]=""})},fe=(s,e=!1)=>{const u=a.selectedTokenId===s.id,d=x(s.id);if(u&&d==="connected"&&!e){l.info(`${s.name} 已选中且已连接`);return}if(u&&d==="connecting"&&!e){l.info(`${s.name} 正在连接中...`);return}a.selectToken(s.id,e)?e?l.success(`强制重连：${s.name}`):u?l.success(`重新连接：${s.name}`):l.success(`已选择：${s.name}`):l.error(`选择Token失败：${s.name}`)},x=s=>a.getWebSocketStatus(s),V=s=>{const e=x(s);return{connected:"已连接",connecting:"连接中...",disconnected:"已断开",error:"连接错误",disconnecting:"断开中..."}[e]||"未连接"},_e=s=>{const e=[{label:"编辑",key:"edit",icon:()=>E(h,null,{default:()=>E(Ve)})},{label:"复制Token",key:"copy",icon:()=>E(h,null,{default:()=>E(Ze)})}];return s.importMethod==="url"&&s.sourceUrl?e.push({label:"从URL刷新",key:"refresh-url",icon:()=>E(h,null,{default:()=>E(De)})}):e.push({label:"重新获取",key:"refresh",icon:()=>E(h,null,{default:()=>E(re)})}),e.push({type:"divider"},{label:"删除",key:"delete",icon:()=>E(h,null,{default:()=>E(He)}),props:{style:{color:"#e74c3c"}}}),e},ke=async(s,e)=>{switch(s){case"edit":he(e);break;case"copy":ge(e);break;case"refresh":j(e);break;case"refresh-url":j(e);break;case"delete":we(e);break}},he=s=>{F.value=s,Object.assign(U,{name:s.name,server:s.server||"",wsUrl:s.wsUrl||""}),W.value=!0},Te=async()=>{if(!(!q.value||!F.value))try{await q.value.validate(),a.updateToken(F.value.id,{name:U.name,server:U.server,wsUrl:U.wsUrl}),l.success("Token信息已更新"),W.value=!1,F.value=null}catch{}},ge=async s=>{try{await navigator.clipboard.writeText(s.token),l.success("Token已复制到剪贴板")}catch{l.error("复制失败")}},we=s=>{A.warning({title:"删除Token",content:`确定要删除Token "${s.name}" 吗？此操作无法恢复。`,positiveText:"确定删除",negativeText:"取消",onPositiveClick:()=>{a.removeToken(s.id),l.success("Token已删除")}})},be=s=>{switch(s){case"export":ye();break;case"import":Ue();break;case"clean":xe();break;case"disconnect":Ce();break;case"clear":Se();break}},ye=()=>{try{const s=a.exportTokens(),e=JSON.stringify(s,null,2),u=new Blob([e],{type:"application/json"}),d=document.createElement("a");d.href=URL.createObjectURL(u),d.download=`tokens_backup_${new Date().toISOString().split("T")[0]}.json`,d.click(),l.success("Token数据已导出")}catch{l.error("导出失败")}},Ue=()=>{const s=document.createElement("input");s.type="file",s.accept=".json",s.onchange=e=>{const u=e.target.files[0];if(u){const d=new FileReader;d.onload=c=>{try{const v=JSON.parse(c.target.result),R=a.importTokens(v);R.success?l.success(R.message):l.error(R.message)}catch{l.error("文件格式错误")}},d.readAsText(u)}},s.click()},xe=()=>{const s=a.cleanExpiredTokens();l.success(`已清理 ${s} 个过期Token`)},Ce=()=>{a.gameTokens.forEach(s=>{a.closeWebSocketConnection(s.id)}),l.success("所有连接已断开")},Se=()=>{A.error({title:"清除所有Token",content:"确定要清除所有Token吗？此操作无法恢复！",positiveText:"确定清除",negativeText:"取消",onPositiveClick:()=>{a.clearAllTokens(),l.success("所有Token已清除")}})},$e=s=>{if(!s)return"";const e=s.length;return e<=8?s:s.substring(0,4)+"***"+s.substring(e-4)},X=s=>new Date(s).toLocaleString("zh-CN"),Ee=()=>{y.push("/dashboard")},Y=async s=>{H.value.add(s.id);try{if(x(s.id)==="connected"){l.success(`${s.name} 已连接，进入任务管理`),y.push("/dashboard");return}l.info(`正在探测 ${s.name} 的连接状态...`);try{await a.createWebSocketConnection(s.id,s.token,s.wsUrl);let u=0;const d=30;for(;u<d;){await new Promise(v=>setTimeout(v,100));const c=x(s.id);if(c==="connected"){l.success(`${s.name} 连接成功，进入任务管理`),y.push("/dashboard");return}if(c==="error")throw new Error("连接失败");u++}throw new Error("连接超时")}catch(u){console.error("连接探测失败:",u),A.warning({title:"连接失败",content:`无法连接到 ${s.name}。可能的原因：

1. Token已过期或无效
2. 网络连接问题
3. 服务器维护中

是否要刷新Token后重试，还是直接进入离线模式？`,positiveText:"刷新Token",negativeText:"离线模式",onPositiveClick:async()=>{try{await j(s),setTimeout(()=>Y(s),1e3)}catch{l.error("Token刷新失败，请检查网络或手动重新导入")}},onNegativeClick:()=>{l.info("进入离线模式，部分功能可能不可用"),y.push("/dashboard")}})}}finally{H.value.delete(s.id)}},Z=async()=>{if(m.token||m.api)try{M.value=!0;let s=null;if(m.api){l.info("正在从API获取token...");const e=await fetch(m.api,{method:"GET",headers:{Accept:"application/json"},mode:"cors"});if(!e.ok)throw new Error(`API请求失败: ${e.status} ${e.statusText}`);const u=await e.json();if(!u.token)throw new Error("API返回数据中未找到token字段");s=a.importBase64Token(m.name||u.name||"通过API导入的Token",u.token,{server:m.server||u.server,wsUrl:m.wsUrl,sourceUrl:m.api,importMethod:"url"})}else m.token&&(l.info("正在导入token..."),s=a.importBase64Token(m.name||"通过URL导入的Token",m.token,{server:m.server,wsUrl:m.wsUrl,importMethod:"url"}));if(s&&s.success)l.success(`Token "${s.tokenName}" 导入成功！`),m.auto&&s.token?(a.selectToken(s.token.id),l.success("正在跳转到控制台..."),setTimeout(()=>{y.push("/dashboard")},1500)):y.replace("/tokens");else throw new Error((s==null?void 0:s.message)||"Token导入失败")}catch(s){console.error("URL参数处理失败:",s),l.error(`导入失败: ${s.message}`),y.replace("/tokens")}finally{M.value=!1}};return Be(()=>[m.token,m.api],Z,{immediate:!1}),Ie(async()=>{a.initTokenStore(),await Z(),!a.hasTokens&&!m.token&&!m.api&&(C.value=!0)}),(s,e)=>{const u=b("n-radio-button"),d=b("n-radio-group"),c=b("n-input"),v=b("n-form-item"),R=b("n-collapse-item"),Q=b("n-collapse"),T=b("n-button"),G=b("n-form"),ee=b("n-dropdown"),Me=b("n-tag"),Re=b("n-empty"),Le=b("n-modal");return _(),g("div",ps,[r("div",vs,[r("div",fs,[r("div",_s,[r("div",ks,[e[17]||(e[17]=r("img",{src:Ne,alt:"XYZW",class:"brand-logo"},null,-1)),t(Oe)]),e[18]||(e[18]=r("h1",null,"游戏Token管理",-1))])]),!i(a).hasTokens||C.value?(_(),g("div",hs,[r("div",Ts,[r("div",gs,[r("h2",null,[t(i(h),null,{default:n(()=>[t(i(te))]),_:1}),e[19]||(e[19]=k(" 添加游戏Token ",-1))]),t(d,{value:B.value,"onUpdate:value":e[0]||(e[0]=o=>B.value=o),class:"import-method-tabs",size:"small"},{default:n(()=>[t(u,{value:"manual"},{default:n(()=>e[20]||(e[20]=[k(" 手动输入 ",-1)])),_:1,__:[20]}),t(u,{value:"url"},{default:n(()=>e[21]||(e[21]=[k(" URL获取 ",-1)])),_:1,__:[21]})]),_:1},8,["value"])]),B.value==="manual"?(_(),L(G,{key:0,ref_key:"importFormRef",ref:N,model:f,rules:le,"label-placement":"top",size:"large","show-label":!0},{default:n(()=>[t(v,{label:"游戏角色名称",path:"name","show-label":!0},{default:n(()=>[t(c,{value:f.name,"onUpdate:value":e[1]||(e[1]=o=>f.name=o),placeholder:"例如：主号战士",clearable:""},null,8,["value"])]),_:1}),t(v,{label:"Token字符串",path:"base64Token","show-label":!0},{default:n(()=>[t(c,{value:f.base64Token,"onUpdate:value":e[2]||(e[2]=o=>f.base64Token=o),type:"textarea",rows:3,placeholder:"粘贴Token字符串...",clearable:""},null,8,["value"])]),_:1}),t(Q,null,{default:n(()=>[t(R,{title:"角色详情 (可选)",name:"optional"},{default:n(()=>[r("div",ws,[t(v,{label:"服务器"},{default:n(()=>[t(c,{value:f.server,"onUpdate:value":e[3]||(e[3]=o=>f.server=o),placeholder:"服务器名称"},null,8,["value"])]),_:1}),t(v,{label:"自定义连接地址"},{default:n(()=>[t(c,{value:f.wsUrl,"onUpdate:value":e[4]||(e[4]=o=>f.wsUrl=o),placeholder:"留空使用默认连接"},null,8,["value"])]),_:1})])]),_:1})]),_:1}),r("div",bs,[t(T,{type:"primary",size:"large",block:"",loading:M.value,onClick:ue},{icon:n(()=>[t(i(h),null,{default:n(()=>[t(i(ne))]),_:1})]),default:n(()=>[e[22]||(e[22]=k(" 添加Token ",-1))]),_:1,__:[22]},8,["loading"]),i(a).hasTokens?(_(),L(T,{key:0,size:"large",block:"",onClick:e[5]||(e[5]=o=>C.value=!1)},{default:n(()=>e[23]||(e[23]=[k(" 取消 ",-1)])),_:1,__:[23]})):w("",!0)])]),_:1},8,["model"])):w("",!0),B.value==="url"?(_(),L(G,{key:1,ref_key:"urlFormRef",ref:O,model:p,rules:ae,"label-placement":"top",size:"large"},{default:n(()=>[t(v,{label:"游戏角色名称",path:"name"},{default:n(()=>[t(c,{value:p.name,"onUpdate:value":e[6]||(e[6]=o=>p.name=o),placeholder:"例如：主号战士",clearable:""},null,8,["value"])]),_:1}),t(v,{label:"Token获取地址",path:"url"},{feedback:n(()=>e[24]||(e[24]=[r("div",{class:"form-tips"},[r("span",{class:"form-tip"}," 接口应返回包含token字段的JSON数据 "),r("span",{class:"form-tip cors-tip"}," 注意：如果是跨域URL，服务器需要支持CORS，否则会被浏览器阻止 ")],-1)])),default:n(()=>[t(c,{value:p.url,"onUpdate:value":e[7]||(e[7]=o=>p.url=o),placeholder:"输入API接口地址...",clearable:""},null,8,["value"])]),_:1}),t(Q,null,{default:n(()=>[t(R,{title:"角色详情 (可选)",name:"optional"},{default:n(()=>[r("div",ys,[t(v,{label:"服务器"},{default:n(()=>[t(c,{value:p.server,"onUpdate:value":e[8]||(e[8]=o=>p.server=o),placeholder:"服务器名称"},null,8,["value"])]),_:1}),t(v,{label:"自定义连接地址"},{default:n(()=>[t(c,{value:p.wsUrl,"onUpdate:value":e[9]||(e[9]=o=>p.wsUrl=o),placeholder:"留空使用默认连接"},null,8,["value"])]),_:1})])]),_:1})]),_:1}),r("div",Us,[t(T,{type:"primary",size:"large",block:"",loading:M.value,onClick:de},{icon:n(()=>[t(i(h),null,{default:n(()=>[t(i(ne))]),_:1})]),default:n(()=>[e[25]||(e[25]=k(" 获取并添加Token ",-1))]),_:1,__:[25]},8,["loading"]),i(a).hasTokens?(_(),L(T,{key:0,size:"large",block:"",onClick:e[10]||(e[10]=o=>C.value=!1)},{default:n(()=>e[26]||(e[26]=[k(" 取消 ",-1)])),_:1,__:[26]})):w("",!0)])]),_:1},8,["model"])):w("",!0)])])):w("",!0),i(a).hasTokens?(_(),g("div",xs,[r("div",Cs,[r("h2",null,"我的Token列表 ("+$(i(a).gameTokens.length)+"个)",1),r("div",Ss,[i(a).selectedToken?(_(),L(T,{key:0,type:"success",onClick:Ee},{icon:n(()=>[t(i(h),null,{default:n(()=>[t(i(oe))]),_:1})]),default:n(()=>[e[27]||(e[27]=k(" 返回控制台 ",-1))]),_:1,__:[27]})):w("",!0),C.value?w("",!0):(_(),L(T,{key:1,type:"primary",onClick:e[11]||(e[11]=o=>C.value=!0)},{icon:n(()=>[t(i(h),null,{default:n(()=>[t(i(te))]),_:1})]),default:n(()=>[e[28]||(e[28]=k(" 添加Token ",-1))]),_:1,__:[28]})),t(ee,{options:ce,onSelect:be},{default:n(()=>[t(T,null,{icon:n(()=>[t(i(h),null,{default:n(()=>[t(i(is))]),_:1})]),default:n(()=>[e[29]||(e[29]=k(" 批量操作 ",-1))]),_:1,__:[29]})]),_:1})])]),r("div",$s,[(_(!0),g(Fe,null,je(i(a).gameTokens,o=>(_(),g("div",{key:o.id,class:K(["token-card",{active:o.id===i(a).selectedTokenId,connected:x(o.id)==="connected"}]),onClick:I=>fe(o)},[r("div",Ms,[r("div",Rs,[r("h3",Ls,[k($(o.name)+" ",1),r("span",{class:K(["connection-indicator",{connected:x(o.id)==="connected",connecting:x(o.id)==="connecting",disconnected:x(o.id)==="disconnected"||!x(o.id),error:x(o.id)==="error"}]),title:V(o.id)},null,10,zs)]),r("div",As,[o.server?(_(),g("span",Ws,$(o.server),1)):w("",!0),r("span",Bs,$(V(o.id)),1)])]),r("div",Is,[t(ee,{options:_e(o),onSelect:I=>ke(I,o)},{default:n(()=>[t(T,{text:""},{icon:n(()=>[t(i(h),null,{default:n(()=>[t(i(Ge))]),_:1})]),_:1})]),_:2},1032,["options","onSelect"])])]),r("div",Fs,[r("div",js,[e[30]||(e[30]=r("span",{class:"token-label"},"Token:",-1)),r("code",Ps,$($e(o.token)),1)]),r("div",Ns,[r("div",Os,[r("span",{class:K(["status-dot",x(o.id)])},null,2),r("span",qs,$(V(o.id)),1)]),r("div",Ds,[t(T,{size:"small",type:"default",loading:D.value.has(o.id),onClick:se(I=>j(o),["stop"])},{icon:n(()=>[t(i(h),null,{default:n(()=>[t(i(re))]),_:1})]),default:n(()=>[k(" "+$(o.sourceUrl?"刷新":"重新获取"),1)]),_:2},1032,["loading","onClick"])])]),r("div",Hs,[r("div",Vs,[e[31]||(e[31]=r("span",{class:"timestamp-label"},"创建：",-1)),r("span",Gs,$(X(o.createdAt)),1)]),r("div",Js,[e[32]||(e[32]=r("span",{class:"timestamp-label"},"使用：",-1)),r("span",Ks,$(X(o.lastUsed)),1)])]),r("div",Xs,[r("div",Ys,[e[33]||(e[33]=r("span",{class:"storage-label"},"存储类型：",-1)),t(Me,{size:"small",type:o.importMethod==="url"?"success":"warning"},{default:n(()=>[k($(o.importMethod==="url"?"长期有效":"临时存储"),1)]),_:2},1032,["type"])]),o.importMethod!=="url"?(_(),g("div",Zs,[t(T,{size:"tiny",type:"success",ghost:"",onClick:se(I=>me(o),["stop"])},{icon:n(()=>[t(i(h),null,{default:n(()=>[t(i(ms))]),_:1})]),default:n(()=>[e[34]||(e[34]=k(" 升级为长期有效 ",-1))]),_:2,__:[34]},1032,["onClick"])])):w("",!0)])]),o.id===i(a).selectedTokenId?(_(),g("div",Qs,[t(T,{type:"primary",size:"large",block:"",loading:H.value.has(o.id),onClick:I=>Y(o)},{icon:n(()=>[t(i(h),null,{default:n(()=>[t(i(oe))]),_:1})]),default:n(()=>[e[35]||(e[35]=k(" 开始任务管理 ",-1))]),_:2,__:[35]},1032,["loading","onClick"])])):w("",!0)],10,Es))),128))])])):w("",!0),!i(a).hasTokens&&!C.value?(_(),g("div",et,[t(Re,{size:"large",description:"还没有导入任何Token"},{icon:n(()=>[t(i(h),{size:"64"},{default:n(()=>[t(i(ts))]),_:1})]),_:1})])):w("",!0)]),t(Le,{show:W.value,"onUpdate:show":e[16]||(e[16]=o=>W.value=o),preset:"card",title:"编辑Token",style:{width:"500px"}},{footer:n(()=>[r("div",st,[t(T,{onClick:e[15]||(e[15]=o=>W.value=!1)},{default:n(()=>e[36]||(e[36]=[k(" 取消 ",-1)])),_:1,__:[36]}),t(T,{type:"primary",onClick:Te},{default:n(()=>e[37]||(e[37]=[k(" 保存 ",-1)])),_:1,__:[37]})])]),default:n(()=>[t(G,{ref_key:"editFormRef",ref:q,model:U,rules:ie,"label-placement":"left","label-width":"80px"},{default:n(()=>[t(v,{label:"名称",path:"name"},{default:n(()=>[t(c,{value:U.name,"onUpdate:value":e[12]||(e[12]=o=>U.name=o)},null,8,["value"])]),_:1}),t(v,{label:"服务器"},{default:n(()=>[t(c,{value:U.server,"onUpdate:value":e[13]||(e[13]=o=>U.server=o)},null,8,["value"])]),_:1}),t(v,{label:"WebSocket地址"},{default:n(()=>[t(c,{value:U.wsUrl,"onUpdate:value":e[14]||(e[14]=o=>U.wsUrl=o)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])])}}},ct=qe(tt,[["__scopeId","data-v-a8bdb4ba"]]);export{ct as default};
